{% extends 'crapdb/base.html' %}

{% block head %}
    {{ block.super }}

    {% load static %}
    <link href="{% static 'crapdb/css/blog.css' %}" rel="stylesheet">
    <link href="{% static 'crapdb/css/matrix.css' %}" rel="stylesheet">
    <link href="{% static 'crapdb/css/flyingflags.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <header>
        <div class="blog-masthead">
            <div class="container">
                <nav class="nav">
                    <a class="nav-link" href="{% url 'crapdb:logout' session_id=session_id %}">Logout</a>
                    <a class="nav-link" onclick="openModal()" id="settingsButton" sessionId="{{ session_id }}" href="#">Edit Settings</a>
                </nav>
            </div>
        </div>

        <div class="blog-header">
            <div class="container">
                {% if session.username %}
                    <h1 class="blog-title">Welcome {{ session.username }}</h1>
                {% else %}
                    {% verbatim %}
                      <!-- NOTE: Change flag value before release -->
                      <h1 class="blog-title">Welcome Flag={__PLACEHOLDER_FLAG__?}</h1>
                    {% endverbatim %}
                {% endif %}

                {% if not session.password %}
                  {% verbatim %}
                  <!-- NOTE: Change flag value before release -->
                      <p class="lead blog-description">How'd you get in here without a Flag={__PLACEHOLDER_FLAG__}</p>
                  {% endverbatim %}
                {% else %}
                    <p class="lead blog-description">A sweet blog about hacking</p>
                {% endif %}
            </div>
        </div>
    </header>

    <main role="main" class="container">
        <div class="row">
            <div class="col-sm-8 blog-main">
                <div class="blog-post">
                    <h2 class="blog-post-title">Hacking The World</h2>
                    <p class="blog-post-meta">January 1, 2014 by <a href="#">Dingus</a></p>
                    <p>
                      Haxx0r ipsum long win syn fopen infinite loop echo todo Donald Knuth gobble 
                      buffer root char January 1, 1970 malloc bin emacs. Back door leet continue 
                      I'm sorry Dave, I'm afraid I can't do that python flood race condition flush 
                      recursively crack bubble sort fatal. Warez over clock overflow dereference 
                      L0phtCrack throw null port packet.
                    </p>
                    <hr>
                    <p>
                        All your base are belong to us spoof <a href="#">Trojan horse</a> mountain dew tcp d00dz 
                        infinite loop recursively. Giga daemon function script kiddies unix root 
                        it's a feature case suitably small values stack trace exception stack. 
                        Void baz syn protected regex January 1, 1970 buffer firewall ascii giga 
                        ddos <strong>Dennis Ritchie</strong> cat warez.
                    </p>
                    <ul>
                        <li>Leapfrog continue Trojan horse fail.</li>
                        <li>buffer perl stack do kilo overflow</li>
                        <li>Leslie Lamport fork char ip grep.</li>
                    </ul>
                </div><!-- /.blog-post -->

                <div class="blog-post">
                    <h2 class="blog-post-title">Hacking Only Part Of The World</h2>
                    <p class="blog-post-meta">December 23, 2013 by <a href="#">Bingus</a></p>
                    <p>
                        Gc echo loop public case foo January 1, 1970 system break if xss perl 
                        fatal /dev/null cd int new bubble sort it's a feature gnu. Strlen cache 
                        try catch bypass eof warez tcp vi python else deadlock fail worm foad 
                        null regex wombat gurfle exception hello world Linus Torvalds. Tunnel 
                        in daemon man pages lib epoch recursively infinite loop grep alloc 
                        highjack error win ctl-c L0phtCrack d00dz.
                    </p>
                    <p>
                        Linus Torvalds Leslie Lamport cd bit rsa terminal baz while fail flood 
                        grep system worm foad bin pwned. Port emacs boolean hash ip highjack 
                        deadlock snarf hack the mainframe giga mutex then tunnel in continue 
                        back door access try catch. Todo Dennis Ritchie finally bubble sort 
                        perl cookie char.
                    </p>
                </div><!-- /.blog-post -->

                <nav class="blog-pagination">
                    <a class="btn btn-outline-primary" href="#">Older</a>
                    <a class="btn btn-outline-secondary disabled" href="#">Newer</a>
                </nav>
            </div><!-- /.blog-main -->

            <aside class="col-sm-3 ml-sm-auto blog-sidebar">
                <div class="sidebar-module sidebar-module-inset">
                    <h4>About</h4>
                    <p>
                        Buffer afk ascii flood ack ssh chown finally client var concurrently gobble 
                        regex gnu. Epoch char bytes ban memory leak thread race condition.
                    </p>
                </div>

                <div class="sidebar-module">
                    <h4>Archives</h4>
                    <ol class="list-unstyled">
                        <li><a href="#">March 2014</a></li>
                        <li><a href="#">February 2014</a></li>
                        <li><a href="#">January 2014</a></li>
                        <li><a href="#">December 2013</a></li>
                        <li><a href="#">November 2013</a></li>
                        <li><a href="#">October 2013</a></li>
                    </ol>
                </div>
            </aside><!-- /.blog-sidebar -->
        </div><!-- /.row -->
    </main><!-- /.container -->

    <footer class="blog-footer">
        <p>Blog template built for 
            <a href="#">Bootstrap</a> by 
            <a href="#">@mdo</a>.
        </p>
        <p>
            <a href="#">Back to top</a>
        </p>
    </footer>

    <div class="modal" tabindex="-1" role="dialog" id="settingsModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">How'd you get here?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="modalBody"></p>
                    <p>
                        You take the blue pill, the story ends. You wake up in your bed and believe whatever you want to believe. You take the red pill, you stay in Wonderland, and I show you how deep the rabbit hole goes.
                    </p>
                    <button type="button" class="btn btn-primary" onclick="bluePill()">Blue Pill</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="redPill()">Red Pill</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <canvas id="matrix" style="display:none"></canvas>
{% endblock %}

{% block script %}
    {{ block.super }}

    {% load static %}
    <script src="{% static 'crapdb/js/matrix.js' %}"></script>
    <script src="{% static 'crapdb/js/flyingflags.js' %}"></script>

    <script>
        var authorized = false;
        function openModal() {
            if (authorized) {
                var session_id = $("#settingsButton").attr("sessionId");
                $.ajax({
                    url: "/crapdb/getmodalflag/" + session_id + "/",
                    type: "GET",
                    success: function(data) {
                        var json = JSON.parse(data);
                        $("#modalBody").text(json.flag);
                        $("#settingsModal").modal({
                            show: true
                        });
                    }
                });
            } else {
                alert("Not authorized!");
            }
        }

        function bluePill() {
            var session_id = $("#settingsButton").attr("sessionId");
            window.location = "/crapdb/logout/" + session_id + "/";
        }

        function redPill() {
            var session_id = $("#settingsButton").attr("sessionId");

            setTimeout(function() {
                $("#matrix").css("display", "unset");
                runMatrix();

                // Triggers the background-color to transition to black
                // because of CSS settings
                $("#matrix").css("background-color", "black");

                setTimeout(function() {
                    flagsForDays(session_id, csrf_token="{{ csrf_token }}");
                }, 10000);
            }, 1000);
        }
    </script>
{% endblock %}